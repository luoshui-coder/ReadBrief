# 产品需求文档（PRD）：ReadBrief插件

## 1. 产品概述

### 1.1 产品名称
ReadBrief (阅读简报)

### 1.2 产品定位
ReadBrief是一款专注于文章内容摘要生成的微信插件，旨在帮助用户快速获取文章核心内容，提高阅读效率。

### 1.3 产品价值
- 为用户节省阅读时间，快速获取文章核心观点
- 以结构化的卡片形式呈现内容，提升阅读体验
- 支持追问功能，深入探索文章内容

## 2. 功能需求

### 2.1 核心功能流程
1. **链接接收**：用户在微信中分享文章链接
2. **内容获取**：插件使用jina读取链接内容
3. **摘要生成**：调用大模型API，根据提示词生成JSON格式摘要
4. **卡片生成**：解析JSON，调用流光卡片API生成可视化卡片
5. **结果展示**：向用户返回卡片或文本摘要（卡片失败时的备选方案）
6. **追问交互**：支持用户在一定时间内针对摘要内容提问

### 2.2 功能详细说明

#### 2.2.1 链接解析
- 支持常见的文章分享链接，包括但不限于：微信公众号、知乎、头条、网页等
- 自动过滤不支持的链接类型（如小程序、视频号等）
- 支持私聊和群聊两种场景

#### 2.2.2 摘要生成
- 配置灵活的提示词模板，生成结构化JSON格式摘要
- 摘要内容包括：
  - 标题洞察：提炼文章核心主题
  - 一句话总结：简明扼要概括文章内容
  - 核心要点：列出3-5个关键信息点
  - AI评论：对文章内容进行智能点评
  - 智能标签：自动生成文章主题标签
  - 预计阅读时间：估算完整阅读所需时间
  - 文章来源：显示原文出处

#### 2.2.3 卡片生成
- 调用流光卡片API生成精美的可视化摘要卡片
- 卡片设计美观，包含文章标题、摘要内容、来源信息
- 支持二维码生成，便于访问原文
- 提供备选方案：当卡片生成失败时，返回文本格式摘要

#### 2.2.4 追问功能
- 用户可在摘要生成后的5分钟内，使用特定前缀发起追问
- 支持多轮对话，深入探讨文章内容
- 保存上下文，确保回答的连贯性

### 2.3 配置项
- 启用/禁用总体功能
- 选择大模型服务提供商
- 群聊功能开关
- 追问功能开关及前缀设置
- 自定义提示词模板
- 卡片生成功能开关及API配置
- API密钥配置

## 3. 技术实现

### 3.1 系统架构
- 基于dify-on-wechat插件框架开发
- 使用Python作为主要开发语言
- 组件化设计，便于扩展和维护

### 3.2 关键技术点
- **内容抓取**：使用jina库实现网页内容抓取
- **大模型调用**：支持多种大模型API（如GPT、Gemini等）
- **JSON解析**：处理大模型返回的结构化数据
- **卡片生成**：调用流光卡片API生成图片
- **用户状态管理**：使用ExpiredDict存储用户上下文和时效性数据

### 3.3 API依赖
- 大模型API：用于生成摘要内容
- 流光卡片API：用于生成可视化卡片
- jina库：用于网页内容抓取

## 4. 用户体验

### 4.1 交互流程
1. 用户分享链接到聊天窗口
2. 插件自动识别链接并处理
3. 返回摘要卡片或文本摘要
4. 用户可使用前缀词进行追问
5. 插件响应追问并提供进一步信息

### 4.2 提示信息
- 摘要生成后提示用户可追问
- 使用表情符号增强可读性
- 适当使用分隔符确保内容层次清晰

### 4.3 错误处理
- 不支持的链接类型给予友好提示
- API调用失败时提供备选方案
- 网络问题时返回明确错误信息

## 5. 性能与稳定性

### 5.1 性能要求
- 摘要生成时间控制在30秒以内
- 追问响应时间控制在15秒以内
- 支持并发处理多个请求

### 5.2 稳定性措施
- 异常捕获与错误日志记录
- 超时处理机制
- 备选方案：卡片生成失败时返回文本

## 6. 安装与配置

### 6.1 安装方式
```
#installp https://github.com/username/readbrief.git
```

### 6.2 配置模板
```json
{
  "readbrief": {
    "enabled": true,
    "service": "gpt-3.5-turbo",
    "group": true,
    "qa_enabled": true,
    "qa_prefix": "问",
    "prompt": "你是一个专业的文章分析师，请为以下文章生成结构化摘要，使用JSON格式返回，包含以下字段：title（标题洞察）, summary（一句话总结）, key_points（3-5个核心要点）, comment（AI评论）, tags（智能标签）, read_time（预计阅读时间）, source（文章来源）",
    "card_enabled": true,
    "card_api_url": "https://fireflycard-api.302ai.cn/api/saveImg"
  },
  "keys": {
    "open_ai_api_key": "",
    "model": "gpt-3.5-turbo",
    "open_ai_api_base": "https://api.openai.com/v1"
  }
}
```

## 7. 未来规划

### 7.1 功能扩展
- 支持更多媒体类型（如视频、音频）摘要
- 增加对PDF、Office文档等文件的支持
- 提供摘要保存到笔记功能
- 支持定制化卡片样式

### 7.2 性能优化
- 缓存机制优化，提高响应速度
- 内容抓取能力增强，适应更多网站格式

## 8. 实施计划

### 8.1 开发阶段
- **Phase 1**：基础框架搭建，实现链接解析和内容抓取
- **Phase 2**：接入大模型API，完成摘要生成核心功能
- **Phase 3**：实现卡片生成和追问功能
- **Phase 4**：完善配置系统和错误处理

### 8.2 测试与发布
- Alpha测试：内部功能测试
- Beta测试：邀请部分用户进行实际使用测试
- 正式发布：完成文档编写，发布插件

### 8.3 持续维护
- 定期更新适配新的链接格式
- 优化提示词以提升摘要质量
- 收集用户反馈持续改进

## 9. 评估指标
- 用户活跃度与留存率
- 摘要请求成功率
- 卡片生成成功率
- 追问使用频率
- 用户反馈满意度
